<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cozy Critters Admin</title>
    <script>
      const token = localStorage.getItem('cmsAuth');
      if (token) {
        const origFetch = window.fetch.bind(window);
        window.fetch = (input, init = {}) => {
          init.headers = init.headers || {};
          if (init.headers instanceof Headers) {
            init.headers.set('Authorization', 'Basic ' + token);
          } else {
            init.headers['Authorization'] = 'Basic ' + token;
          }
          return origFetch(input, init);
        };
      }
    </script>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js" defer></script>
  </head>
  <body>
    <div id="cms"></div>
    <script type="module">
      import MoodsPreview from './previews/moods.js';
      import GamesPreview from './previews/games.js';
      import PagesPreview from './previews/pages.js';
      import GameDifficultyWidget from './widgets/game-difficulty.js';
      import MoodColorWidget from './widgets/mood-color.js';

      CMS.registerPreviewStyle('https://cdn.jsdelivr.net/npm/tailwindcss@3.4.17/dist/tailwind.min.css');
      CMS.registerPreviewStyle('https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.5.15/dist/typography.min.css');

      CMS.registerPreviewTemplate('moods', MoodsPreview);
      CMS.registerPreviewTemplate('games', GamesPreview);
      CMS.registerPreviewTemplate('pages', PagesPreview);

      CMS.registerWidget('game-difficulty', GameDifficultyWidget.control, GameDifficultyWidget.preview);
      CMS.registerWidget('mood-color', MoodColorWidget.control, MoodColorWidget.preview);

      CMS.init({ element: document.getElementById('cms') });
    </script>
  </body>
</html>
